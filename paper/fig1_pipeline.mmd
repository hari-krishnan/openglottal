%% Figure 1: Overview of the three main inference pipelines (U-Net only, YOLO+UNet, YOLO-Crop+UNet).
%% Spelling: use "YOLO detector" and "Gate" (not detectir / Gane). Export at high resolution (e.g. 300 DPI) for publication.
%% Solid arrows = data flow; gate = output zero when YOLO does not detect (or after ≥4 consecutive misses).
%% Input and output are outside any subgraph. Use with: mermaid-cli (mmdc) or Mermaid Live Editor.

flowchart LR

    IN("Input frame<br/>(grayscale)")
    M1["Segmentation mask"]

    subgraph unet_only["U-Net only"]
        U1["Full-frame U-Net"]
    end
    IN --> U1 --> M1

    subgraph yolo_unet["YOLO+UNet"]
        Y2["YOLO detector"]
        G2{"Gate"}
        U2["Full-frame U-Net"]
        Z2["Mask outside bbox → 0"]
        Y2 --> G2
        G2 -->|"No detect (or ≥4 misses)"| ZERO2["Output = 0"]
        G2 -->|"Detect"| U2
        U2 --> Z2
    end
    IN --> Y2
    Z2 --> M1

    subgraph yolo_crop["YOLO-Crop+UNet"]
        Y3["YOLO detector"]
        G3{"Gate"}
        C3["Crop + resize 256×256"]
        U3["Crop-mode U-Net"]
        P3["Resize back, paste"]
        Y3 --> G3
        G3 -->|"No detect (or ≥4 misses)"| ZERO3["Output = 0"]
        G3 -->|"Detect"| C3
        C3 --> U3 --> P3
    end
    IN --> Y3
    P3 --> M1

    style G2 fill:#fff3cd
    style G3 fill:#fff3cd
    style ZERO2 fill:#f8d7da
    style ZERO3 fill:#f8d7da
    style IN fill:#e7f3ff
